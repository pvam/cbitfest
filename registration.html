<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Registration</title>
<link href="assets/css/bootstrap.css" rel="stylesheet">
<style>
/*.border-radius
{
	 border-top-left-radius:150px; 
	 border-bottom-left-radius:150px; 
	 border-top-right-radius:150px; 
	 border-bottom-right-radius:150px;
}*/
/*.label1
{
	color:#FFF;
	font-weight:bolder;
}*/
.background {
	background-color:#CECECE;
}

</style>
</head>

<body class="background">

<div class="container">
<!--top margin of 50px-->
<div class="row">
<div style="height:50px">&nbsp;</div>
</div>
<!--actual division for registration form-->
<div class="offset2 span8 border-radius" style="background-color:rgba(229,229,229,0.25);border:thick;border-color:#F3C">
<!--registration form-->
  <div class="span8">
<form class="form-horizontal" id="registerHere">
    <div class="row">
    <div class="span2">
    <img src="images/card.png">
    </div>
    <div class="span5">
    <div class="row" style="height:50%"> &nbsp;</div>
        <h2 style="color:#666">Sign up to get started!</h2>
    </div>
    </div>
    
    <div class="row span7">
    <hr class="divider">
    </div>
    
    <div class="control-group row-fluid offset1">
    <button class="btn btn-large btn-primary span4 " style="background:#526CA4">
    Log in with FB
    </button>
    <button class="btn btn-large btn-primary span4" style="background:#C00">Log in with Google</button>
    </div>
    <div class="control-group row-fluid offset1">
    <button class="btn btn-large btn-primary span8" style="background:#F30">Log in with Microsoft Account</button>
    </div>

	  <fieldset>
	    <div class="control-group input-prepend">
	      <label class="control-label label1">Name</label>
	      <div class="controls">
              <span class="add-on">
              <i class="icon-user"></i>
              </span>
	        <input type="text" class="input-xlarge" id="name" name="user_name" required>	        
	      </div>
	</div>
	
	 <div class="control-group input-prepend">
		<label class="control-label label1">Email</label>
	      <div class="controls">
              <span class="add-on">
              <i class="icon-envelope"></i>
              </span>
	        <input type="email" class="input-xlarge" id="email" name="user_email" required>
	      </div>
	</div>
	
	<div class="control-group input-prepend">
		<label class="control-label label1">Password</label>
	      <div class="controls">
              <span class="add-on">
              <i class="icon-lock"></i>
              </span>
	        <input type="password" class="input-xlarge" id="pwd" name="pwd" required >      
	      </div>
	</div>
    
    	<div class="control-group input-prepend">
		<label class="control-label label1">Handle</label>
	      <div class="controls">
              <span class="add-on">
              <i class="icon-tag"></i>
              </span>
	        <input type="text" class="input-xlarge" id="handle" name="handle" required onBlur="checkhandle()">
            <img id="correct" src="images/tick.png" style="visibility:hidden">
            <img id="wrong" src="images/error.png" style="visibility:hidden">	       
	      </div>
	</div>
    	
	<div class="control-group">
	      <div class="controls">
	       <input type="submit" class="btn btn-large btn-success" onClick="check();" value="Create my iCard"> 
	      </div>
	</div>  
	  </fieldset>
	</form>
</div>
  <div class="row">
<div style="height:50px">&nbsp;</div>
</div>
</div>
</div>
<!--all the script comes here-->
<script src="http://twitter.github.com/bootstrap/assets/js/jquery.js"></script>
	<script type="text/javascript" src="http://jzaefferer.github.com/jquery-validation/jquery.validate.js"></script>
	  <script type="text/javascript">
	  var enc=new Object();
var handlecorrect = false;
/*verifying the handle on focus lost*/
function checkhandle()
{
document.getElementById("correct").style.visibility = "hidden";
	document.getElementById("wrong").style.visibility = "hidden";
	var handle = document.getElementById("handle").value;
	 /*ajax call to verify handle correctness*/
			    var xhr = new XMLHttpRequest();
				xhr.open('GET', 'registration.php?id='+handle,false);
				xhr.send(null);
				var response = xhr.responseText;
				if(response == "present")
				{
				handlecorrect = false;
				document.getElementById("wrong").style.visibility = "visible";
				}
				else
				{
				handlecorrect = true;
				document.getElementById("correct").style.visibility = "visible";
				}

}
/*verifying the details on button click*/
function check()
{ 
	if(handlecorrect)
	{
		enc.firstname=document.getElementById("name").value;
		enc.email = document.getElementById("email").value;
		enc.password = document.getElementById("pwd").value;
		handle = document.getElementById("handle").value;
		var encoded = JSON.stringify(enc);
					/*ajax call to verify handle correctness*/
		  var xhr = new XMLHttpRequest();
		  xhr.open('GET','reginsert.php?id='+handle+'&object='+encoded,false);
		  xhr.send(null);
		  var response = xhr.responseText;
		  if(response == "success")
		  {
			  alert("success");
		  }
		  else
		  alert("error");
	}
}

	  $(document).ready(function(){
			$("#registerHere").validate({
				rules:{
					user_name:"required",
					user_email:{
							required:true,
							email: true
						},
					pwd:{
						required:true,
					},
					handle:"required",
				},
				messages:{
					user_name:"please enter your first and last name",
					user_email:{
						required:"please enter your email address",
						email:"please enter valid email address"
					},
					pwd:{
						required:"please enter your password",
					},
					handle:{
						required:"please enter your handle",
					},
				},
				errorClass: "help-inline",
				errorElement: "span",
				highlight:function(element, errorClass, validClass) {
					$(element).parents('.control-group').addClass('error');
				},
				unhighlight: function(element, errorClass, validClass) {
					$(element).parents('.control-group').removeClass('error');
					$(element).parents('.control-group').addClass('success');
				}
			});
		});
	  </script>
  </body>
</html>

